<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker - Debug</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', sans-serif; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 10px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        pre { background-color: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .status-indicator { width: 20px; height: 20px; border-radius: 50%; display: inline-block; margin-right: 10px; }
        .status-online { background-color: #28a745; }
        .status-offline { background-color: #dc3545; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">
                    <i class="bi bi-bug"></i> Expense Tracker Debug Panel
                </h1>
                
                <!-- Connection Status -->
                <div class="test-section info">
                    <h3>
                        <span class="status-indicator" id="connection-status"></span>
                        Backend Connection Status
                    </h3>
                    <p id="connection-message">Checking connection...</p>
                    <button class="btn btn-primary" onclick="checkConnection()">
                        <i class="bi bi-arrow-clockwise"></i> Test Connection
                    </button>
                </div>

                <!-- Registration Test -->
                <div class="test-section">
                    <h3><i class="bi bi-person-plus"></i> Registration Test</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <input type="text" class="form-control mb-2" id="test-name" placeholder="Name" value="Test User">
                        </div>
                        <div class="col-md-4">
                            <input type="email" class="form-control mb-2" id="test-email" placeholder="Email" value="test@example.com">
                        </div>
                        <div class="col-md-4">
                            <input type="password" class="form-control mb-2" id="test-password" placeholder="Password" value="123456">
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="testRegistration()">
                        <i class="bi bi-person-plus"></i> Test Registration
                    </button>
                    <div id="registration-result" class="mt-3"></div>
                </div>

                <!-- Login Test -->
                <div class="test-section">
                    <h3><i class="bi bi-box-arrow-in-right"></i> Login Test</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <input type="email" class="form-control mb-2" id="login-email" placeholder="Email" value="test@example.com">
                        </div>
                        <div class="col-md-6">
                            <input type="password" class="form-control mb-2" id="login-password" placeholder="Password" value="123456">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="testLogin()">
                        <i class="bi bi-box-arrow-in-right"></i> Test Login
                    </button>
                    <div id="login-result" class="mt-3"></div>
                </div>

                <!-- API Endpoints Test -->
                <div class="test-section">
                    <h3><i class="bi bi-list-check"></i> API Endpoints Test</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <button class="btn btn-outline-primary w-100 mb-2" onclick="testEndpoint('GET', '/api/test')">
                                Test Backend
                            </button>
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-outline-info w-100 mb-2" onclick="testEndpoint('GET', '/api/user/get-income')">
                                Test Income API
                            </button>
                        </div>
                    </div>
                    <div id="endpoint-result" class="mt-3"></div>
                </div>

                <!-- Environment Info -->
                <div class="test-section info">
                    <h3><i class="bi bi-info-circle"></i> Environment Information</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Frontend URL:</strong> <span id="frontend-url"></span><br>
                            <strong>Backend URL:</strong> <span id="backend-url"></span><br>
                            <strong>User Agent:</strong> <span id="user-agent"></span>
                        </div>
                        <div class="col-md-6">
                            <strong>Local Storage:</strong> <span id="local-storage-status"></span><br>
                            <strong>Cookies:</strong> <span id="cookies-status"></span><br>
                            <strong>Screen Size:</strong> <span id="screen-size"></span>
                        </div>
                    </div>
                </div>

                <!-- Console Log -->
                <div class="test-section">
                    <h3><i class="bi bi-terminal"></i> Console Log</h3>
                    <div class="d-flex justify-content-between mb-2">
                        <button class="btn btn-sm btn-outline-secondary" onclick="clearConsole()">
                            <i class="bi bi-trash"></i> Clear Log
                        </button>
                        <button class="btn btn-sm btn-outline-primary" onclick="exportLog()">
                            <i class="bi bi-download"></i> Export Log
                        </button>
                    </div>
                    <pre id="console-log" style="max-height: 300px; overflow-y: auto;"></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:4000/api/user';
        let consoleLog = [];

        // Initialize debug panel
        document.addEventListener('DOMContentLoaded', function() {
            updateEnvironmentInfo();
            checkConnection();
            setupConsoleCapture();
        });

        function updateEnvironmentInfo() {
            document.getElementById('frontend-url').textContent = window.location.href;
            document.getElementById('backend-url').textContent = API_BASE_URL;
            document.getElementById('user-agent').textContent = navigator.userAgent;
            document.getElementById('local-storage-status').textContent = localStorage ? 'Available' : 'Not Available';
            document.getElementById('cookies-status').textContent = navigator.cookieEnabled ? 'Enabled' : 'Disabled';
            document.getElementById('screen-size').textContent = `${screen.width}x${screen.height}`;
        }

        function setupConsoleCapture() {
            const originalLog = console.log;
            const originalError = console.error;
            const originalWarn = console.warn;

            console.log = function(...args) {
                originalLog.apply(console, args);
                addToConsole('LOG', args);
            };

            console.error = function(...args) {
                originalError.apply(console, args);
                addToConsole('ERROR', args);
            };

            console.warn = function(...args) {
                originalWarn.apply(console, args);
                addToConsole('WARN', args);
            };
        }

        function addToConsole(level, args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            consoleLog.push({ timestamp, level, message });
            updateConsoleDisplay();
        }

        function updateConsoleDisplay() {
            const logElement = document.getElementById('console-log');
            logElement.textContent = consoleLog.map(log => 
                `[${log.timestamp}] ${log.level}: ${log.message}`
            ).join('\n');
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearConsole() {
            consoleLog = [];
            updateConsoleDisplay();
        }

        function exportLog() {
            const logText = consoleLog.map(log => 
                `[${log.timestamp}] ${log.level}: ${log.message}`
            ).join('\n');
            
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `debug-log-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        async function checkConnection() {
            const statusIndicator = document.getElementById('connection-status');
            const messageElement = document.getElementById('connection-message');
            
            try {
                                 const response = await fetch('http://localhost:4000/api/test');
                const data = await response.json();
                
                statusIndicator.className = 'status-indicator status-online';
                messageElement.textContent = `Backend is running! Response: ${data.message}`;
                messageElement.className = 'text-success';
                
                console.log('Backend connection successful:', data);
            } catch (error) {
                statusIndicator.className = 'status-indicator status-offline';
                messageElement.textContent = `Backend connection failed: ${error.message}`;
                messageElement.className = 'text-danger';
                
                console.error('Backend connection failed:', error);
            }
        }

        async function testRegistration() {
            const resultDiv = document.getElementById('registration-result');
            const name = document.getElementById('test-name').value;
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;
            
            try {
                console.log('Testing registration with:', { name, email, password: '***' });
                
                const response = await fetch(`${API_BASE_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });
                
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="${data.success ? 'success' : 'error'} p-3 rounded">
                        <strong>${data.success ? 'Success' : 'Error'}:</strong> ${data.message}
                        <pre class="mt-2">${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
                
                console.log('Registration test result:', data);
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error p-3 rounded">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
                console.error('Registration test failed:', error);
            }
        }

        async function testLogin() {
            const resultDiv = document.getElementById('login-result');
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                console.log('Testing login with email:', email);
                
                const response = await fetch(`${API_BASE_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="${data.success ? 'success' : 'error'} p-3 rounded">
                        <strong>${data.success ? 'Success' : 'Error'}:</strong> ${data.message}
                        <pre class="mt-2">${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
                
                console.log('Login test result:', data);
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error p-3 rounded">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
                console.error('Login test failed:', error);
            }
        }

        async function testEndpoint(method, endpoint) {
            const resultDiv = document.getElementById('endpoint-result');
            
            try {
                console.log(`Testing ${method} ${endpoint}`);
                
                                 const response = await fetch(`http://localhost:4000${endpoint}`, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="info p-3 rounded">
                        <strong>${method} ${endpoint}:</strong>
                        <pre class="mt-2">${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
                
                console.log(`Endpoint test result:`, data);
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error p-3 rounded">
                        <strong>Error testing ${method} ${endpoint}:</strong> ${error.message}
                    </div>
                `;
                console.error(`Endpoint test failed:`, error);
            }
        }
    </script>
</body>
</html> 